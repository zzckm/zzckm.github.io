<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<script>
    (function(){
        if(''){
            if (prompt('请输入查看该篇文章的密码') !== ''){
                alert('密码错误，请咨询博主');
                history.back();
            }
        }
    })();
</script>


  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-flash.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "39f09b08"
    });
  daovoice('update');
  </script>















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="CDH,">










<meta name="description" content="CDH安装文档前言Cloudera Manager 架构![image_1cr7ui3hq12jp1qtmcic19c1sa39.png-67.2kB][1] Cloudera Manager 的架构如上图所示（cs结构），主要由如下几部分组成:  服务端/Server:Cloudera Manager 的核心。主要用于管理 web server 和应 用逻辑。它用于安装软件，配置，开始和停止服务">
<meta name="keywords" content="CDH">
<meta property="og:type" content="article">
<meta property="og:title" content="CDH安装文档-Cloudera Manager">
<meta property="og:url" content="http://yoursite.com/2019/04/25/1_CDH安装文档/index.html">
<meta property="og:site_name" content="To树-HOME">
<meta property="og:description" content="CDH安装文档前言Cloudera Manager 架构![image_1cr7ui3hq12jp1qtmcic19c1sa39.png-67.2kB][1] Cloudera Manager 的架构如上图所示（cs结构），主要由如下几部分组成:  服务端/Server:Cloudera Manager 的核心。主要用于管理 web server 和应 用逻辑。它用于安装软件，配置，开始和停止服务">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/ogbw8dju2fvc1o2tb2vjndkd/image_1cr7ui3hq12jp1qtmcic19c1sa39.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/caom6uixock1i7hrvog9h6ob/image_1cr86pb1v1sls5tg1lml1mjn1ql9m.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/ktds3ociczb6v1hmedex4da8/image_1cr86sad41aje1lcn11hj1llc1ca013.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/8j4dqs87h9a9bz2pkcydu3su/image_1cr8704k3q8skga69n1thj2a71g.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/658tslyfpe0v2wksj47qadpi/image_1cr871dst164r6iq65713rfi781t.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/e2sul6wwhd79v7o7fw5ft013/image_1cr875jm9da7pvo1kd515fd1efg2a.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/rvlacm9glpp91hrdrqfu0h6z/image_1cr877kuc1rv54qi1upro8n13be2n.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/gym33jt5gpx2c4r8oqsjf410/image_1cr87bf9h1hiq4gt1r883jb1d9f34.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/0jyrcaioj1iz6kmbsg72zxui/image_1cr87ja8e1u98t3seek1s9311b03h.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/fblifuir1024kxbffioodtwd/image_1cr87loa2t011ik1ts41ngp1jq33u.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/z3qpqekpsn67rb891qftu7o1/image_1cr87vrvi1l9vhtl1jmv1scbioh4b.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/tjmaer7yd84iabkfq6yfpu0d/image_1cr882f9jd3r1bs31498vrpvd4o.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/8r1yq6nfu8zn0wndp7j2xgdn/image_1cr887909t6q1rfggtjiivhv055.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/uezb8ezaqkwrkcyxd8vhryae/image_1cr888o2t10sdm601hlg1njn17ho5i.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/4mx4ssqf0mk9nonlettnlqac/image_1cr88g66aomtgone8llrqi4e5v.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/cnfcq9v0ymv9tqxfac5qtmw7/image_1cr88k1fc4gdvi6qob8rn1p4k6s.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/xb388330wilubzeomsc8o9bt/image_1cr88lvu8e891vjovde1mm5ht779.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/ttsmoygr7t2tpce73k9p0plq/image_1cr4i1pr2189r166rn3ucn1k0q1p.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/92isrcqeic9dvwp2ms0tfkbi/image_1cr4i2ij41mfqv4qa4iv841mn026.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/72nhqt1u4ag6y71tcji49juk/image_1cr4i3odi1ndsh1qiehvms1a3j.png">
<meta property="og:image" content="http://static.zybuluo.com/zhangwen100/82qfkwnhyrp8ti0e9i8p5rtq/image_1cr4i48vm1ih1p6s1hlhirh1jd540.png">
<meta property="og:updated_time" content="2019-05-26T08:58:42.530Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CDH安装文档-Cloudera Manager">
<meta name="twitter:description" content="CDH安装文档前言Cloudera Manager 架构![image_1cr7ui3hq12jp1qtmcic19c1sa39.png-67.2kB][1] Cloudera Manager 的架构如上图所示（cs结构），主要由如下几部分组成:  服务端/Server:Cloudera Manager 的核心。主要用于管理 web server 和应 用逻辑。它用于安装软件，配置，开始和停止服务">
<meta name="twitter:image" content="http://static.zybuluo.com/zhangwen100/ogbw8dju2fvc1o2tb2vjndkd/image_1cr7ui3hq12jp1qtmcic19c1sa39.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/04/25/1_CDH安装文档/">





  <title>CDH安装文档-Cloudera Manager | To树-HOME</title>
  









<!-- katex样式 -->
  <link href="https://cdn.bootcss.com/KaTeX/0.7.1/katex.min.css" rel="stylesheet">
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    
  <a href="https://github.com/zzckm" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">To树-HOME</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">只可意会</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/25/1_CDH安装文档/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ckm_zz">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/ggg.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="To树-HOME">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">CDH安装文档-Cloudera Manager</h1>
        

        <div class="post-meta">
        <!-- TOP -->
        

          <span class="post-time">
            

            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2019-05-26T16:58:42+08:00">
                2019-05-26
              </time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/大数据应用/" itemprop="url" rel="index">
                    <span itemprop="name">大数据应用</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv">
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  4.3k 字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  21 分钟
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="CDH安装文档"><a href="#CDH安装文档" class="headerlink" title="CDH安装文档"></a>CDH安装文档</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="Cloudera-Manager-架构"><a href="#Cloudera-Manager-架构" class="headerlink" title="Cloudera Manager 架构"></a>Cloudera Manager 架构</h3><p>![image_1cr7ui3hq12jp1qtmcic19c1sa39.png-67.2kB][1]</p>
<p>Cloudera Manager 的架构如上图所示（cs结构），主要由如下几部分组成:</p>
<ul>
<li><p>服务端/Server:<br>Cloudera Manager 的核心。主要用于管理 web server 和应 用逻辑。它用于安装软件，配置，开始和停止服务，以及管理服务运行的集群。</p>
</li>
<li><p>代理/agent:<br>安装在每台主机上。它负责启动和停止的进程，部署配置，触发安装和监控主机。</p>
</li>
<li><p>数据库/Database:<br>存储配置和监控信息。通常可以在一个或多个数据库服务器上运行的多个逻辑数据库。例如，所述的 Cloudera 管理器服务和监视，后台程序使用不同的逻辑数据库。</p>
</li>
<li><p>Cloudera Repository: ：由cloudera manager 提供的软件分发库</p>
</li>
<li><p>客户端/Clients:<br>提供了一个与 Server 交互的接口:</p>
</li>
<li><p>管理平台/Admin Console:提供一个管理员管理集群和 Cloudera Manage 的基于网页的交互界面。</p>
</li>
<li><p>API:为开发者提供了创造自定义 Cloudera Manager 程序的 API。</p>
</li>
</ul>
<h2 id="1-集群规划"><a href="#1-集群规划" class="headerlink" title="1. 集群规划"></a>1. 集群规划</h2><dl><dt>集群节点分配</dt><dd>|主机名|主机IP|主机内存|硬盘存储|<br>|—|—|—|—|<br>|node01|192.168.100.101|7G|70G|<br>|node02|192.168.100.102|4G|50G|<br>|node03|192.168.100.103|4G|50G|<br>|node04|192.168.100.104|4G|50G|<br>|node05|192.168.100.105|4G|50G|</dd></dl><dl><dt>软件版本</dt><dd>|软件名称|版本号|<br>|—|—|<br>|Java|1.8.0_162|<br>|MySQL|5.7.24|<br>|CentOS|CentOS-7-x86_64-DVD-1804|<br>|CDH|5.15.1|</dd></dl><dl><dt>各软件安装路径</dt><dd>|软件名|路径地址|<br>|—|—|<br>|CM|/opt/apps/cm-5.15.1|<br>|Java|/opt/apps/Java|</dd></dl><h2 id="2-软件下载"><a href="#2-软件下载" class="headerlink" title="2. 软件下载"></a>2. 软件下载</h2><h3 id="2-1-JDK-下载"><a href="#2-1-JDK-下载" class="headerlink" title="2.1 JDK 下载"></a>2.1 JDK 下载</h3><p>jdk-8u162-linux-x64.rpm 下载<br>[下载地址][2]</p>
<p>注意<br>: </p>
<pre><code>1. JDK必须是64位。不要使用32位JDK。
2. 已安装的JDK必须是受支持的版本，如[CDH和Cloudera Manager支持的JDK版本][3]中所述。
3. 在相同版本的JDK必须安装在每个集群主机上。
4. 这里建议下载rpm版本，自动安装会更好一些</code></pre><h3 id="2-2-MySQL-下载"><a href="#2-2-MySQL-下载" class="headerlink" title="2.2 MySQL 下载"></a>2.2 MySQL 下载</h3><p>以下组件都需要数据库：Cloudera Manager Server，Oozie Server，Sqoop Server，活动监视器，Reports Manager，Hive Metastore Server，Hue Server，Sentry Server，Cloudera Navigator Audit Server和Cloudera Navigator Metadata Server。数据库中包含的数据类型及其相对大小如下：</p>
<ul>
<li>Cloudera Manager Server - 包含有关已配置的服务及其角色分配，所有配置历史记录，命令，用户和正在运行的进程的所有信息。这个是相对较小的数据库（&lt;100 MB），非常重要，必须备份。<strong>注意：</strong>重新启动进程时，将使用Cloudera Manager数据库中保存的信息重新部署每个服务的配置。如果此信息不可用，则集群无法启动或正常运行。您必须安排并维护Cloudera Manager数据库的定期备份，以便在丢失此数据库时恢复集群。</li>
<li>Oozie Server - 包含Oozie工作流，协调器和捆绑数据。可以长得很大。</li>
<li>Sqoop Server - 包含连接器，驱动程序，链接和作业等实体。相对较小。</li>
<li>Activity Monitor - 包含有关过去活动的信息。在大型集群中，此数据库可能会变大。只有部署了MapReduce服务，才需要配置活动监视器数据库。</li>
<li>Reports Manager - 跟踪磁盘利用率和处理活动。中型。</li>
<li>Hive Metastore Server - 包含Hive元数据。相对较小。</li>
<li>Hue服务器 - 包含用户帐户信息，作业提交和Hive查询。相对较小。</li>
<li>Sentry Server - 包含授权元数据。相对较小。</li>
<li>Cloudera Navigator Audit Server - 包含审计信息。在大型集群中，此数据库可能会变大。</li>
<li>Cloudera Navigator Metadata Server - 包含授权，策略和审计报告元数据。相对较小。</li>
</ul>
<p>mysql-5.7.24-1.el7.x86_64.rpm-bundle.tar.gz<br>[下载地址][4]</p>
<h3 id="2-3-CDH-相关下载"><a href="#2-3-CDH-相关下载" class="headerlink" title="2.3 CDH 相关下载"></a>2.3 CDH 相关下载</h3><p>[manifest.json][5]<br>[CDH-5.15.1-1.cdh5.15.1.p0.4-el7.parcel][6]<br>[CDH-5.15.1-1.cdh5.15.1.p0.4-el7.parcel.sha1][7]<br>[cloudera-manager-centos7-cm5.15.1_x86_64.tar.gz][8]</p>
<h2 id="3-基本配置"><a href="#3-基本配置" class="headerlink" title="3. 基本配置"></a>3. 基本配置</h2><h3 id="3-0-网路配置"><a href="#3-0-网路配置" class="headerlink" title="3.0 网路配置"></a>3.0 网路配置</h3><p>此配置在这里不再过多赘述，在centos 7安装过程中就可以将网络配置完成</p>
<h3 id="3-1-修改主机名并配置hosts（所有节点）"><a href="#3-1-修改主机名并配置hosts（所有节点）" class="headerlink" title="3.1 修改主机名并配置hosts（所有节点）"></a>3.1 修改主机名并配置hosts（所有节点）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 修改主机名（这里使用的是centos 7的命令，建议在安装的时候就配置好）</span></span></span><br><span class="line">[root@localhost ~]# hostnamectl set-hostname node01</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 修改hosts文件</span></span></span><br><span class="line">[root@node01 ~]# vim /etc/hosts</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 注释前两行，添加以下内容</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span><br><span class="line"><span class="meta">#</span><span class="bash">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span><br><span class="line">192.168.100.101 node01</span><br><span class="line">192.168.100.102 node02</span><br><span class="line">192.168.100.103 node03</span><br><span class="line">192.168.100.104 node04</span><br><span class="line">192.168.100.105 node05</span><br></pre></td></tr></table></figure>

<h3 id="3-2-小工具安装（所有节点）"><a href="#3-2-小工具安装（所有节点）" class="headerlink" title="3.2 小工具安装（所有节点）"></a>3.2 小工具安装（所有节点）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 安装vim编辑器</span></span></span><br><span class="line">[root@node01 ~]# yum -y install vim</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 安装上传下载工具</span></span></span><br><span class="line">[root@node01 ~]# yum -y install lrzsz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 安装pstree</span></span></span><br><span class="line">[root@node01 ~]# yum -y install psmisc</span><br><span class="line"></span><br><span class="line">[root@node01 init.d]# yum -y install httpd</span><br><span class="line">[root@node01 init.d]# yum -y install mod_ssl</span><br><span class="line">[root@node01 init.d]# yum -y install rpcbind</span><br><span class="line">[root@node01 ~]# systemctl start rpcbind</span><br><span class="line">[root@node01 java]# yum install -y python-lxml</span><br></pre></td></tr></table></figure>

<h3 id="3-3-NTP服务器配置（所有节点，用于几个节点的时间同步）"><a href="#3-3-NTP服务器配置（所有节点，用于几个节点的时间同步）" class="headerlink" title="3.3 NTP服务器配置（所有节点，用于几个节点的时间同步）"></a>3.3 NTP服务器配置（所有节点，用于几个节点的时间同步）</h3><p>集群中所有主机必须保持时间同步，如果时间相差较大会引起各种问题。 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 ~]# vim  /etc/ntp.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 修改内容为</span></span></span><br><span class="line">server 0.pool.ntp.org</span><br><span class="line">server 1.pool.ntp.org</span><br><span class="line">server 2.pool.ntp.org</span><br><span class="line">[root@node01 ~]# systemctl start ntpd</span><br><span class="line">[root@node01 ~]# systemctl restart ntpd</span><br><span class="line">[root@node01 ~]# systemctl enable ntpd</span><br><span class="line">[root@node01 ~]# ntpdate -u time.nist.gov</span><br><span class="line"> 2 Nov 13:12:53 ntpdate[31560]: step time server 132.163.96.1 offset 1812.928750 sec</span><br><span class="line">[root@node01 ~]# hwclock --systohc</span><br></pre></td></tr></table></figure>

<h3 id="3-4-关闭防火墙（所有节点）"><a href="#3-4-关闭防火墙（所有节点）" class="headerlink" title="3.4 关闭防火墙（所有节点）"></a>3.4 关闭防火墙（所有节点）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 关闭防火墙</span></span></span><br><span class="line">[root@node01 ~]# systemctl stop firewalld</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 禁止开机启动防火墙</span></span></span><br><span class="line">[root@node01 ~]# systemctl disable firewalld</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 关闭SELinux（重启生效）</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># SELinux主要作用就是最大限度地减小系统中服务进程可访问的资源（最小权限原则）。如果开启，可能会导致文件权限修改不了等问题</span></span></span><br><span class="line">[root@node01 ~]# vim /etc/selinux/config</span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure>

<h3 id="3-5-SSH免密码（所有节点）"><a href="#3-5-SSH免密码（所有节点）" class="headerlink" title="3.5 SSH免密码（所有节点）"></a>3.5 SSH免密码（所有节点）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 先ssh一下，产生相应的隐藏目录</span></span></span><br><span class="line">[root@node01 Java]# ssh localhost</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 进入到用户主目录的.ssh目录</span></span></span><br><span class="line">[root@node01 Java]# cd ~/.ssh</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 产生公钥和私钥</span></span></span><br><span class="line">[root@node01 .ssh]# ssh-keygen -t rsa -P ''</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 将每台机器上的id_rsa.pub公钥内容复制到authorized_keys文件中</span></span></span><br><span class="line">[root@node01 .ssh]# cp id_rsa.pub authorized_keys</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 将所有的authorized_keys文件进行合并（最简单的方法是将其余节点的文件内容追加到node01主机上）</span></span></span><br><span class="line">[root@node02 .ssh]# cat ~/.ssh/authorized_keys | ssh root@node01 'cat &gt;&gt; ~/.ssh/authorized_keys'</span><br><span class="line">[root@node03 .ssh]# cat ~/.ssh/authorized_keys | ssh root@node01 'cat &gt;&gt; ~/.ssh/authorized_keys'</span><br><span class="line">[root@node04 .ssh]# cat ~/.ssh/authorized_keys | ssh root@node01 'cat &gt;&gt; ~/.ssh/authorized_keys'</span><br><span class="line">[root@node05 .ssh]# cat ~/.ssh/authorized_keys | ssh root@node01 'cat &gt;&gt; ~/.ssh/authorized_keys'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 查看node01上的authorized_keys文件内容，类似如下即可</span></span></span><br><span class="line">eys</span><br><span class="line">[root@node01 .ssh]# more authorized_keys </span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQD4AUA+aUYpSYEWnOhD8apy7nNGZvwYGQhn3aA8Q6cn2fLYN2NVipOeAqXmFD4ao0gPF</span><br><span class="line">oqzt+ylxb3xGZ5QHKLQpDGSHyspXaJV+ow13IwDKpGuWjN9NgrldCw2eCYDBffEVnWVSRTSGw7KdJYdmE8cBxziDDQPBBIiDz8uXLeEf6</span><br><span class="line">RafvgJXm+NmGVIxKs+dj/Bve7dIEVBtCxhEWcUQZXGEGl0H0JxwRWRACgYXgJg6oVnaRA8T0b1CUdvekiH7hnoWAgSSHgFnTdhzcicAZe</span><br><span class="line">GESCCjJDqYmm8Njbpr/X98uyBOtojMS1d9kYqtO85QN7/VG/n1Hc5aLvZLYFDvwN9 root@node01</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC8ZiYNqOkm3HfheBehnA/D+1qk1T/7/DmNjfCTgEHG4HhrhghC7RUH2Nbrar29Ad0Lm</span><br><span class="line">H48jbtgHeftIadoXvEqojc9wOKuIQkJmyu/7ab0t35/W4fbA8x+dH23Gr1ZV05OiqaT/QrCbaOxx/oC2QSyh5mukP5PIyMNlskO4ywgr2</span><br><span class="line">QINST5qur4F7xfR+yzZH/j8Bo9aUKlKpSgXacfkhnWBV5L8BJEnEgAUIutIN8ZOIF08HW7YO8sYsyAy4Ram4M81SuCpe01DfbWInnX37j</span><br><span class="line">5lthcw3I0cpZ4txhSZsM1BtRUpNsU24TB8ryCEIiGHvFJd6ljgfG2kKoFqgUUSqZ9 root@node04</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCSZxq0qWHdUIDOYypw2qzrt9rNwUOyABUxyVjuxpDEOD3td7X5D9h+fQjPYwhwUcVHN</span><br><span class="line">tEApsvvV2Rbp6gn8eGUIBlkX2rJCfbsJIJSJTRq9E8LiRcDSNdbqqjzIpf/qbIcYRl/2MBxS60k2wQE6/cCBwWpil+YyIplttI58y/CfU</span><br><span class="line">t6wygy2LEeMox4VrljgdTj27hhrIIzL7K8BLJcpPS9hgK2oMd3/YNeM8RhStR6SdlSNd06s9GD0xMDfY1IzAqd+7DzGp3WZOuQAOjgD2E</span><br><span class="line">j1bMjta5B4pg84HH+qLdwU2i+Yt/ycDAZBREadVWBWS+DTQdPof5wYgDXXOET4SU1 root@node02</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDN177q22IpskSzCzLQBRGTguJWBKR+EJ/qgE0f4vNOJgHvZyWOObabHQOnktRonKEW4</span><br><span class="line">ShKyK1w9xf406YK7FTeyOHrYb+j3Zi+A0YbWgjScd6XxmMLQDVmVgJhUMSgAVL+4s9rrQ1g5baVU8W5O2xr0dVSXXWF5khtV5aCfxU/O1</span><br><span class="line">Mkmbt9WiCfp5I6biwXQj41Sm77l8EDSm1rijmXi0zc3uxtEqvqDJXV0A6s7vpQLJ9sw4kkwFdki1hwU9irG+E9ci70egZr3wuBYEdGzmJ</span><br><span class="line">9UNiCUvNjS5S0Q4FvjptyOcfad/7Oqbch2JNCWRSLu5Vyi9bcK+ulKOtmS+IX6Ivl root@node05</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC4nV01w7sPiOBO8Be/8OfTFYZxC3xSoR4Tm1wgXbUa3nJpsjqw/blIeEUWwb18MRZ7V</span><br><span class="line">1EEvJw+/HXh4ZiEALHAb/KxeH/BNifJJ4BZO/SMXOmQKupX4LzSzBoBAxDvY8c9+E2EImP2v1Bd4Hqf7Wfs/UJlW0BAgNbDJTpje+CFQn</span><br><span class="line">lOQPQC2zxuhWUm2yuRe2kuxAki5m7j1N2JeQFyUtTArXeWRRfRpTCK56MGfGYET65Wb1uFYANklo1LmcFHgw41haWj3suRjm3uqwSLfn3</span><br><span class="line">LCsY5lOGn3L6iuNBoVkIuEcllET4dIUiX8Yaajs1/m/Lqcx2GrhOJHQ35HKl+AUFf root@node03</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 将node01上的authorized_keys文件分发到其他主机上</span></span></span><br><span class="line">[root@node01 .ssh]# scp ~/.ssh/authorized_keys root@node02:~/.ssh/</span><br><span class="line">[root@node01 .ssh]# scp ~/.ssh/authorized_keys root@node03:~/.ssh/</span><br><span class="line">[root@node01 .ssh]# scp ~/.ssh/authorized_keys root@node04:~/.ssh/</span><br><span class="line">[root@node01 .ssh]# scp ~/.ssh/authorized_keys root@node05:~/.ssh/</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 每台机器之间进行ssh免密码登录操作，包括自己与自己</span></span></span><br></pre></td></tr></table></figure>

<h3 id="3-6-JDK安装（所有节点）"><a href="#3-6-JDK安装（所有节点）" class="headerlink" title="3.6 JDK安装（所有节点）"></a>3.6 JDK安装（所有节点）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 创建Java相应目录</span></span></span><br><span class="line">[root@node01 ~]# mkdir -p /opt/apps/Java</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 通过rz命令上传文件</span></span></span><br><span class="line">[root@node01 ~]# cd /opt/apps/Java</span><br><span class="line">[root@node01 Java]# rz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 建议使用以下方式安装——省事而且不会出错</span></span></span><br><span class="line">[root@node01 Java]# rpm -ivh jdk-8u162-linux-x64.rpm </span><br><span class="line">准备中...                          ################################# [100%]</span><br><span class="line">正在升级/安装...</span><br><span class="line">   1:jdk1.8-2000:1.8.0_162-fcs        ################################# [100%]</span><br><span class="line">Unpacking JAR files...</span><br><span class="line">	tools.jar...</span><br><span class="line">	plugin.jar...</span><br><span class="line">	javaws.jar...</span><br><span class="line">	deploy.jar...</span><br><span class="line">	rt.jar...</span><br><span class="line">	jsse.jar...</span><br><span class="line">	charsets.jar...</span><br><span class="line">	localedata.jar...</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 测试安装是否生效</span></span></span><br><span class="line">[root@node01 Java]# java -version</span><br><span class="line">java version "1.8.0_162"</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_162-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.162-b12, mixed mode)</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 在环境变量中配置JAVA_HOME</span></span></span><br><span class="line">[root@node01 Java]# vim /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="bash">添加以下内容</span></span><br><span class="line">export JAVA_HOME=/usr/java/jdk1.8.0_162</span><br></pre></td></tr></table></figure>

<p>{
name:”zhangsan”,</p>
<p>}</p>
<h3 id="3-7-安装MySQL数据库（主节点安装即可）"><a href="#3-7-安装MySQL数据库（主节点安装即可）" class="headerlink" title="3.7 安装MySQL数据库（主节点安装即可）"></a>3.7 安装MySQL数据库（主节点安装即可）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 注意：MySQL只需要在CM server主机上安装即可</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 首先要写在数据库mariadb</span></span></span><br><span class="line">[root@node01 MySQL]# rpm -qa | grep mariadb</span><br><span class="line">mariadb-libs-5.5.56-2.el7.x86_64</span><br><span class="line">[root@node01 MySQL]# rpm -e --nodeps mariadb-libs-5.5.56-2.el7.x86_64</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 否则会报一下错误</span></span></span><br><span class="line">error: Failed dependencies:</span><br><span class="line">	mysql-community-common(x86-64) &gt;= 5.7.9 is needed by mysql-community-libs-5.7.24-1.el7.x86_64</span><br><span class="line">	mariadb-libs is obsoleted by mysql-community-libs-5.7.24-1.el7.x86_64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 创建相应的MySQL目录（并不会安装在这个目录）</span></span></span><br><span class="line">[root@node01 ~]# mkdir /opt/apps/MySQL</span><br><span class="line">[root@node01 ~]# cd /opt/apps/MySQL</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 使用rz命令上传</span></span></span><br><span class="line">[root@node01 MySQL]# rz</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 解包（注意：不是解压）</span></span></span><br><span class="line">[root@node01 MySQL]# tar -xvf mysql-5.7.24-1.el7.x86_64.rpm-bundle.tar</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 开始安装：注意安装顺序</span></span></span><br><span class="line">[root@node01 MySQL]# rpm -ivh mysql-community-common-5.7.24-1.el7.x86_64.rpm</span><br><span class="line">[root@node01 MySQL]# rpm -ivh mysql-community-libs-5.7.24-1.el7.x86_64.rpm</span><br><span class="line">[root@node01 MySQL]# rpm -ivh mysql-community-libs-compat-5.7.24-1.el7.x86_64.rpm</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 不安装的话会出现错误，缺少这个依赖</span></span></span><br><span class="line">[root@node01 MySQL]# yum -y install net-tools</span><br><span class="line">[root@node01 MySQL]# rpm -ivh mysql-community-client-5.7.24-1.el7.x86_64.rpm</span><br><span class="line">[root@node01 MySQL]# rpm -ivh mysql-community-server-5.7.24-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 启动mysql服务</span></span></span><br><span class="line">[root@node01 MySQL]# systemctl start mysqld</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 修改配置文件：详细看原来的Hadoop安装文档上的MySQL安装</span></span></span><br><span class="line">[root@node01 MySQL]# vim /etc/my.cnf</span><br><span class="line"><span class="meta">#</span><span class="bash"> CDH官方推荐以下配置</span></span><br><span class="line">transaction-isolation = READ-COMMITTED</span><br><span class="line">key_buffer_size = 32M</span><br><span class="line">max_allowed_packet = 32M</span><br><span class="line">thread_stack = 256K</span><br><span class="line">thread_cache_size = 64</span><br><span class="line">query_cache_limit = 8M</span><br><span class="line">query_cache_size = 64M</span><br><span class="line">query_cache_type = 1</span><br><span class="line">max_connections = 550</span><br><span class="line">log_bin=/var/lib/mysql/mysql_binary_log</span><br><span class="line">server_id=1</span><br><span class="line">binlog_format = mixed</span><br><span class="line">read_buffer_size = 2M</span><br><span class="line">read_rnd_buffer_size = 16M</span><br><span class="line">sort_buffer_size = 8M</span><br><span class="line">join_buffer_size = 8M</span><br><span class="line"><span class="meta">#</span><span class="bash"> InnoDB settings</span></span><br><span class="line">innodb_file_per_table = 1</span><br><span class="line">innodb_flush_log_at_trx_commit  = 2</span><br><span class="line">innodb_log_buffer_size = 64M</span><br><span class="line">innodb_buffer_pool_size = 4G</span><br><span class="line">innodb_thread_concurrency = 8</span><br><span class="line">innodb_flush_method = O_DIRECT</span><br><span class="line">innodb_log_file_size = 512M</span><br><span class="line">sql_mode=STRICT_ALL_TABLES</span><br><span class="line"><span class="meta">#</span><span class="bash"> 取消密码安全策略</span></span><br><span class="line">validate_password=off</span><br><span class="line">character_set_server=utf8</span><br><span class="line">init_connect='SET NAMES utf8'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">重新启动mysql服务</span></span><br><span class="line">[root@master opt]# systemctl restart mysqld</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 查看初始化密码</span></span></span><br><span class="line">[root@node01 MySQL]# cat /var/log/mysqld.log |grep password</span><br><span class="line">2018-10-30T17:06:31.899394Z 1 [Note] A temporary password is generated for root@localhost: 54epwShQg9)B</span><br><span class="line">2018-10-30T17:14:39.775316Z 0 [Note] Shutting down plugin 'validate_password'</span><br><span class="line">2018-10-30T17:14:40.796592Z 0 [Note] Shutting down plugin 'sha256_password'</span><br><span class="line">2018-10-30T17:14:40.796596Z 0 [Note] Shutting down plugin 'mysql_native_password'</span><br><span class="line">2018-10-30T17:14:42.674505Z 0 [Note] Plugin 'validate_password' is disabled.</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 进入mysql客户端</span></span></span><br><span class="line">[root@node01 MySQL]# mysql -uroot -p</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 修改密码</span></span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> ALTER USER <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'123456'</span>;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 修改root的远程访问权限</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># root代表用户名 , %代表任何主机都可以访问 , 123456为root访问的密码</span></span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> GRANT ALL PRIVILEGES ON *.* TO <span class="string">'root'</span>@<span class="string">'%'</span> IDENTIFIED BY <span class="string">'123456'</span> WITH GRANT OPTION; </span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># flush privileges刷新MySQL的系统权限,使其即时生效，否则就重启服务器</span></span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> FLUSH PRIVILEGES;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 创建数据库，以备后用</span></span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> CREATE DATABASE scm DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</span></span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> CREATE DATABASE amon DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> CREATE DATABASE rman DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> CREATE DATABASE hue DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> CREATE DATABASE metastore DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> CREATE DATABASE sentry DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> CREATE DATABASE nav DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> CREATE DATABASE navms DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> CREATE DATABASE oozie DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 退出</span></span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">exit</span>;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-7-安装Cloudera-Manager-Server-（主节点操作）"><a href="#3-7-安装Cloudera-Manager-Server-（主节点操作）" class="headerlink" title="3.7 安装Cloudera Manager Server （主节点操作）"></a>3.7 安装Cloudera Manager Server （主节点操作）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 上传cloudera-manager-centos7-cm5.15.1_x86_64.tar.gz到/opt/apps目录</span></span></span><br><span class="line">[root@node01 apps]# rz</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 解压</span></span></span><br><span class="line">[root@node01 apps]# tar -zxvf cloudera-manager-centos7-cm5.15.1_x86_64.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 删除这个压缩包</span></span></span><br><span class="line">[root@node01 apps]# rm -rf cloudera-manager-centos7-cm5.15.1_x86_64.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ls查看如下</span></span></span><br><span class="line">[root@node01 apps]# ls</span><br><span class="line">cloudera  cm-5.15.1  Java  MySQL</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 为Cloudera Manager建立数据库</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 上传mysql驱动jar包到/usr/share/java</span></span></span><br><span class="line">[root@node01 apps]# mkdir -p /usr/share/java</span><br><span class="line">[root@node01 apps]# cd /usr/share/java/</span><br><span class="line">[root@node01 java]# rz</span><br><span class="line">[root@node01 java]# mv mysql-connector-java-5.1.47-bin.jar mysql-connector-java.jar </span><br><span class="line">[root@node01 java]# ls</span><br><span class="line">mysql-connector-java.jar</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 启动脚本：进入到/opt/apps/cm-5.15.1/share/cmf/schema目录</span></span></span><br><span class="line">[root@node01 schema]# ./scm_prepare_database.sh mysql scm root</span><br><span class="line">Enter SCM password: </span><br><span class="line">JAVA_HOME=/usr/java/jdk1.8.0_162</span><br><span class="line">Verifying that we can write to /opt/apps/cm-5.15.1/etc/cloudera-scm-server</span><br><span class="line">Creating SCM configuration file in /opt/apps/cm-5.15.1/etc/cloudera-scm-server</span><br><span class="line">groups: cloudera-scm: no such user</span><br><span class="line">Executing:  /usr/java/jdk1.8.0_162/bin/java -cp /usr/share/java/mysql-connector-java.jar:/usr/share/java/oracle-connector-java.jar:/usr/share/java/postgresql-connector-java.jar:/opt/apps/cm-5.15.1/share/cmf/schema/../lib/* com.cloudera.enterprise.dbutil.DbCommandExecutor /opt/apps/cm-5.15.1/etc/cloudera-scm-server/db.properties com.cloudera.cmf.db.</span><br><span class="line">Wed Oct 31 01:25:14 CST 2018 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.</span><br><span class="line">2018-10-31 01:25:15,925 [main] INFO  com.cloudera.enterprise.dbutil.DbCommandExecutor  - Successfully connected to database.</span><br><span class="line">All done, your SCM database is configured correctly!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 配置Cloudera Manager Agent(每台节点)</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 修改CM主机地址：目录/opt/apps/cm-5.15.1/etc/cloudera-scm-agent</span></span></span><br><span class="line">[root@node01 cloudera-scm-agent]# vim config.ini</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 修改如下</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Hostname of the CM server.</span></span><br><span class="line">server_host=node01</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 拷贝cm目录到其他节点</span></span></span><br><span class="line">[root@node01 apps]# scp -r cm-5.15.1 root@node02:/opt/apps/</span><br><span class="line">[root@node01 apps]# scp -r cm-5.15.1 root@node03:/opt/apps/</span><br><span class="line">[root@node01 apps]# scp -r cm-5.15.1 root@node04:/opt/apps/</span><br><span class="line">[root@node01 apps]# scp -r cm-5.15.1 root@node05:/opt/apps/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 准备Parcels，用以安装CDH</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 上传下面几个文件到指定目录：/opt/apps/cloudera/parcel-repo</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CDH-5.15.1-1.cdh5.15.1.p0.4-el7.parcel</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CDH-5.15.1-1.cdh5.15.1.p0.4-el7.parcel.sha</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> manifest.json</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 创建cloudera-scm用户（每台节点均执行）</span></span></span><br><span class="line">[root@node01 ~]# useradd --system --home=/opt/apps/cm-5.15.1/run/cloudera-scm-server/ --no-create-home --shell=/bin/false --comment "Cloudera SCM User" cloudera-scm</span><br></pre></td></tr></table></figure>

<h2 id="4-创建快照"><a href="#4-创建快照" class="headerlink" title="4. 创建快照"></a>4. 创建快照</h2><h2 id="4-启动"><a href="#4-启动" class="headerlink" title="4. 启动"></a>4. 启动</h2><h3 id="4-1-启动cloudera-scm-server"><a href="#4-1-启动cloudera-scm-server" class="headerlink" title="4.1 启动cloudera-scm-server"></a>4.1 启动cloudera-scm-server</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@node01 ~]# cd /opt/apps/cm-5.15.1/etc/init.d/</span><br><span class="line">[root@node01 init.d]# ./cloudera-scm-server start</span><br></pre></td></tr></table></figure>

<h3 id="4-2-启动cloudera-scm-agent"><a href="#4-2-启动cloudera-scm-agent" class="headerlink" title="4.2 启动cloudera-scm-agent"></a>4.2 启动cloudera-scm-agent</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 ~]# cd /opt/apps/cm-5.15.1/etc/init.d/</span><br><span class="line">[root@node01 init.d]# ./cloudera-scm-agent start</span><br></pre></td></tr></table></figure>

<h3 id="4-3-进入web界面开始安装"><a href="#4-3-进入web界面开始安装" class="headerlink" title="4.3 进入web界面开始安装"></a>4.3 进入web界面开始安装</h3><p><a href="http://192.168.100.101:7180/cmf/login" target="_blank" rel="noopener">http://192.168.100.101:7180/cmf/login</a><br>![image_1cr86pb1v1sls5tg1lml1mjn1ql9m.png-48.4kB][9]<br>![image_1cr86sad41aje1lcn11hj1llc1ca013.png-202kB][10]<br>![image_1cr8704k3q8skga69n1thj2a71g.png-130.4kB][11]<br>![image_1cr871dst164r6iq65713rfi781t.png-152.3kB][12]<br>![image_1cr875jm9da7pvo1kd515fd1efg2a.png-127.8kB][13]<br>![image_1cr877kuc1rv54qi1upro8n13be2n.png-127.5kB][14]<br>![image_1cr87bf9h1hiq4gt1r883jb1d9f34.png-132.6kB][15]</p>
<h4 id="4-3-1-接下来重启server"><a href="#4-3-1-接下来重启server" class="headerlink" title="4.3.1 接下来重启server"></a>4.3.1 接下来重启server</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 init.d]# ./cloudera-scm-server restart</span><br><span class="line">Stopping cloudera-scm-server:                              [  确定  ]</span><br><span class="line">Starting cloudera-scm-server:                              [  确定  ]</span><br></pre></td></tr></table></figure>

<h4 id="4-3-2-重启之后，仍然正常登录到这一步"><a href="#4-3-2-重启之后，仍然正常登录到这一步" class="headerlink" title="4.3.2 重启之后，仍然正常登录到这一步"></a>4.3.2 重启之后，仍然正常登录到这一步</h4><p>![image_1cr87ja8e1u98t3seek1s9311b03h.png-143.8kB][16]<br>![image_1cr87loa2t011ik1ts41ngp1jq33u.png-72.4kB][17]<br>![image_1cr87vrvi1l9vhtl1jmv1scbioh4b.png-75.2kB][18]<br>![image_1cr882f9jd3r1bs31498vrpvd4o.png-153kB][19]</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 出现以上警告，则在所有主机上执行下面的命令</span></span></span><br><span class="line">[root@node01 init.d]# echo 10 &gt; /proc/sys/vm/swappiness</span><br><span class="line">[root@node01 init.d]# echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line">[root@node01 init.d]# echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">[root@node01 init.d]# echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag &gt;&gt; /etc/rc.local</span><br><span class="line">[root@node01 init.d]# echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled &gt;&gt; /etc/rc.local</span><br></pre></td></tr></table></figure>

<p>![image_1cr887909t6q1rfggtjiivhv055.png-130.7kB][20]<br>![image_1cr888o2t10sdm601hlg1njn17ho5i.png-149.8kB][21]<br>![image_1cr88g66aomtgone8llrqi4e5v.png-117.1kB][22]<br>![image_1cr88k1fc4gdvi6qob8rn1p4k6s.png-155.8kB][23]</p>
<p>![image_1cr88lvu8e891vjovde1mm5ht779.png-151kB][24]</p>
<p>![image_1cr4i1pr2189r166rn3ucn1k0q1p.png-120.5kB][25]<br>![image_1cr4i2ij41mfqv4qa4iv841mn026.png-108.8kB][26]<br>![image_1cr4i3odi1ndsh1qiehvms1a3j.png-100.5kB][27]<br>![image_1cr4i48vm1ih1p6s1hlhirh1jd540.png-114.4kB][28]<br>后面一步一步走即可</p>
<h2 id="4-4-设置开机自启"><a href="#4-4-设置开机自启" class="headerlink" title="4.4 设置开机自启"></a>4.4 设置开机自启</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 1. 复制脚本 cloudera-scm-server 到 server 主机上/etc/init.d</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 2. 复制脚本 cloudera-scm-agent 到所有的 agent 主机上</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 3. 设置agent开机自启</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.1 每台主机均执行添加到开机自启项</span></span><br><span class="line">[root@node01 init.d]# chkconfig --add cloudera-scm-agent</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.2 设置自启</span></span><br><span class="line">[root@node01 init.d]# chkconfig cloudera-scm-agent on</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.3 展示自启内容，2-5开启说明配置成功</span></span><br><span class="line">[root@node01 init.d]# chkconfig --list cloudera-scm-agent </span><br><span class="line"></span><br><span class="line">注：该输出结果只显示 SysV 服务，并不包含</span><br><span class="line">原生 systemd 服务。SysV 配置数据</span><br><span class="line">可能被原生 systemd 配置覆盖。 </span><br><span class="line"></span><br><span class="line">      要列出 systemd 服务，请执行 'systemctl list-unit-files'。</span><br><span class="line">      查看在具体 target 启用的服务请执行</span><br><span class="line">      'systemctl list-dependencies [target]'。</span><br><span class="line"></span><br><span class="line">cloudera-scm-agent	0:关	1:关	2:开	3:开	4:开	5:开	6:关</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 4. 设置server开机自启</span></span></span><br><span class="line">[root@node01 init.d]# chkconfig --add cloudera-scm-server </span><br><span class="line">[root@node01 init.d]# chkconfig cloudera-scm-server on</span><br><span class="line">[root@node01 init.d]# chkconfig --list cloudera-scm-server </span><br><span class="line"></span><br><span class="line">注：该输出结果只显示 SysV 服务，并不包含</span><br><span class="line">原生 systemd 服务。SysV 配置数据</span><br><span class="line">可能被原生 systemd 配置覆盖。 </span><br><span class="line"></span><br><span class="line">      要列出 systemd 服务，请执行 'systemctl list-unit-files'。</span><br><span class="line">      查看在具体 target 启用的服务请执行</span><br><span class="line">      'systemctl list-dependencies [target]'。</span><br><span class="line"></span><br><span class="line">cloudera-scm-server	0:关	1:关	2:开	3:开	4:开	5:开	6:关</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 5. 修改配置信息，否则失败</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5.1 修改cloudera-scm-server与agent脚本中的CMF_DEFAULTS</span></span><br><span class="line">[root@node01 init.d]# vim /etc/init.d/cloudera-scm-agent</span><br><span class="line">CMF_DEFAULTS=$&#123;CMF_DEFAULTS:-/opt/apps/cm-5.15.1/etc/default&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 6. 错误信息集锦</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 6.1 错误1</span></span></span><br><span class="line">[root@node01 init.d]# systemctl status cloudera-scm-server </span><br><span class="line">● cloudera-scm-server.service - LSB: Cloudera SCM Server</span><br><span class="line">   Loaded: loaded (/etc/rc.d/init.d/cloudera-scm-server; bad; vendor preset: disabled)</span><br><span class="line">   Active: failed (Result: exit-code) since 日 2018-11-04 09:24:49 CST; 6min ago</span><br><span class="line">     Docs: man:systemd-sysv-generator(8)</span><br><span class="line">  Process: 943 ExecStart=/etc/rc.d/init.d/cloudera-scm-server start (code=exited, status=1/FAILURE)</span><br><span class="line"></span><br><span class="line">11月 04 09:24:49 node01 systemd[1]: Starting LSB: Cloudera SCM Server...</span><br><span class="line">11月 04 09:24:49 node01 cloudera-scm-server[943]: File not found: /usr/sbin/cmf-server</span><br><span class="line">11月 04 09:24:49 node01 systemd[1]: cloudera-scm-server.service: control process exite...s=1</span><br><span class="line">11月 04 09:24:49 node01 systemd[1]: Failed to start LSB: Cloudera SCM Server.</span><br><span class="line">11月 04 09:24:49 node01 systemd[1]: Unit cloudera-scm-server.service entered failed state.</span><br><span class="line">11月 04 09:24:49 node01 systemd[1]: cloudera-scm-server.service failed.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 6.1 解决方案</span></span></span><br><span class="line">修改cloudera-scm-server与agent脚本中的CMF_DEFAULTS</span><br></pre></td></tr></table></figure>

<h2 id="错误总结"><a href="#错误总结" class="headerlink" title="错误总结"></a>错误总结</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Unable to verify database connection.</span></span></span><br><span class="line">[root@node01 java]# yum install -y python-lxml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Hue启动出错</span></span></span><br><span class="line">[root@node01 init.d]# yum -y install httpd</span><br><span class="line">[root@node01 init.d]# yum -y install mod_ssl</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># No portmap or rpcbind service is running on this host. Please start portmap or rpcbind service before attempting to start the NFS Gateway role on this host.</span></span></span><br><span class="line">[root@node01 init.d]# yum -y install rpcbind</span><br></pre></td></tr></table></figure>

<p>  <img src="http://static.zybuluo.com/zhangwen100/ogbw8dju2fvc1o2tb2vjndkd/image_1cr7ui3hq12jp1qtmcic19c1sa39.png" alt="1"><br>  [2](<a href="https://download.oracle.com/otn/java/jdk/8u181-b13/96a7b8442fe848ef90c96a2fad6ed6d1/jdk-8u181-linux-x64.tar.gz?AuthParam=1540826002_cc60927e5e66e3999064c255b8e675da" target="_blank" rel="noopener">https://download.oracle.com/otn/java/jdk/8u181-b13/96a7b8442fe848ef90c96a2fad6ed6d1/jdk-8u181-linux-x64.tar.gz?AuthParam=1540826002_cc60927e5e66e3999064c255b8e675da</a><br>  [3](<a href="https://www.cloudera.com/documentation/enterprise/release-notes/topics/rn_consolidated_pcm.html#pcm_jdk" target="_blank" rel="noopener">https://www.cloudera.com/documentation/enterprise/release-notes/topics/rn_consolidated_pcm.html#pcm_jdk</a><br>  [4](<a href="https://dev.mysql.com/downloads/file/?id=481064" target="_blank" rel="noopener">https://dev.mysql.com/downloads/file/?id=481064</a><br>  [5](<a href="http://archive.cloudera.com/cdh5/parcels/latest/manifest.json" target="_blank" rel="noopener">http://archive.cloudera.com/cdh5/parcels/latest/manifest.json</a><br>  [6](<a href="http://archive.cloudera.com/cdh5/parcels/5.15.1/" target="_blank" rel="noopener">http://archive.cloudera.com/cdh5/parcels/5.15.1/</a><br>  [7](<a href="http://archive.cloudera.com/cdh5/parcels/5.15.1/" target="_blank" rel="noopener">http://archive.cloudera.com/cdh5/parcels/5.15.1/</a><br>  [8](<a href="http://archive.cloudera.com/cm5/cm/5/" target="_blank" rel="noopener">http://archive.cloudera.com/cm5/cm/5/</a><br>  <img src="http://static.zybuluo.com/zhangwen100/caom6uixock1i7hrvog9h6ob/image_1cr86pb1v1sls5tg1lml1mjn1ql9m.png" alt="9"><br>  <img src="http://static.zybuluo.com/zhangwen100/ktds3ociczb6v1hmedex4da8/image_1cr86sad41aje1lcn11hj1llc1ca013.png" alt="10"><br>  <img src="http://static.zybuluo.com/zhangwen100/8j4dqs87h9a9bz2pkcydu3su/image_1cr8704k3q8skga69n1thj2a71g.png" alt="11"><br>  <img src="http://static.zybuluo.com/zhangwen100/658tslyfpe0v2wksj47qadpi/image_1cr871dst164r6iq65713rfi781t.png" alt="12"><br>  <img src="http://static.zybuluo.com/zhangwen100/e2sul6wwhd79v7o7fw5ft013/image_1cr875jm9da7pvo1kd515fd1efg2a.png" alt="13"><br>  <img src="http://static.zybuluo.com/zhangwen100/rvlacm9glpp91hrdrqfu0h6z/image_1cr877kuc1rv54qi1upro8n13be2n.png" alt="14"><br>  <img src="http://static.zybuluo.com/zhangwen100/gym33jt5gpx2c4r8oqsjf410/image_1cr87bf9h1hiq4gt1r883jb1d9f34.png" alt="15"><br>  <img src="http://static.zybuluo.com/zhangwen100/0jyrcaioj1iz6kmbsg72zxui/image_1cr87ja8e1u98t3seek1s9311b03h.png" alt="16"><br>  <img src="http://static.zybuluo.com/zhangwen100/fblifuir1024kxbffioodtwd/image_1cr87loa2t011ik1ts41ngp1jq33u.png" alt="17"><br>  <img src="http://static.zybuluo.com/zhangwen100/z3qpqekpsn67rb891qftu7o1/image_1cr87vrvi1l9vhtl1jmv1scbioh4b.png" alt="18"><br>  <img src="http://static.zybuluo.com/zhangwen100/tjmaer7yd84iabkfq6yfpu0d/image_1cr882f9jd3r1bs31498vrpvd4o.png" alt="19"><br>  <img src="http://static.zybuluo.com/zhangwen100/8r1yq6nfu8zn0wndp7j2xgdn/image_1cr887909t6q1rfggtjiivhv055.png" alt="20"><br>  <img src="http://static.zybuluo.com/zhangwen100/uezb8ezaqkwrkcyxd8vhryae/image_1cr888o2t10sdm601hlg1njn17ho5i.png" alt="21"><br>  <img src="http://static.zybuluo.com/zhangwen100/4mx4ssqf0mk9nonlettnlqac/image_1cr88g66aomtgone8llrqi4e5v.png" alt="22"><br>  <img src="http://static.zybuluo.com/zhangwen100/cnfcq9v0ymv9tqxfac5qtmw7/image_1cr88k1fc4gdvi6qob8rn1p4k6s.png" alt="23"><br>  <img src="http://static.zybuluo.com/zhangwen100/xb388330wilubzeomsc8o9bt/image_1cr88lvu8e891vjovde1mm5ht779.png" alt="24"><br>  <img src="http://static.zybuluo.com/zhangwen100/ttsmoygr7t2tpce73k9p0plq/image_1cr4i1pr2189r166rn3ucn1k0q1p.png" alt="25"><br>  <img src="http://static.zybuluo.com/zhangwen100/92isrcqeic9dvwp2ms0tfkbi/image_1cr4i2ij41mfqv4qa4iv841mn026.png" alt="26"><br>  <img src="http://static.zybuluo.com/zhangwen100/72nhqt1u4ag6y71tcji49juk/image_1cr4i3odi1ndsh1qiehvms1a3j.png" alt="27"><br>  <img src="http://static.zybuluo.com/zhangwen100/82qfkwnhyrp8ti0e9i8p5rtq/image_1cr4i48vm1ih1p6s1hlhirh1jd540.png" alt="28"></p>

      
    </div>
    
    
    

    

    

    


<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
  
</div>




    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/CDH/" rel="tag"><i class="fa fa-tag"></i> CDH</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/25/1_Linux第一天__/" rel="next" title="Linux第一天">
                <i class="fa fa-chevron-left"></i> Linux第一天
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/04/25/1_Cookie与Sessio_n/" rel="prev" title="Cookie与Session">
                Cookie与Session <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80MzQ4MC8yMDAyMA"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/ggg.jpg" alt="Ckm_zz">
            
              <p class="site-author-name" itemprop="name">Ckm_zz</p>
              <p class="site-description motion-element" itemprop="description">—— not too bad luck</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">67</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">59</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zzckm" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://www.totree.cn" target="_blank" title="To树商城">
                      
                        <i class="fa fa-fw fa-skype"></i></a>
                  </span>
                
            </div>
          
<!-- 音乐播放器 -->
 
           <div>
              <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="210" height="110" src="//music.163.com/outchain/player?type=2&id=3932159&auto=1&height=66"></iframe>
           </div>
 

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#CDH安装文档"><span class="nav-number">1.</span> <span class="nav-text">CDH安装文档</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.1.</span> <span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Cloudera-Manager-架构"><span class="nav-number">1.1.1.</span> <span class="nav-text">Cloudera Manager 架构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-集群规划"><span class="nav-number">1.2.</span> <span class="nav-text">1. 集群规划</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-软件下载"><span class="nav-number">1.3.</span> <span class="nav-text">2. 软件下载</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-JDK-下载"><span class="nav-number">1.3.1.</span> <span class="nav-text">2.1 JDK 下载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-MySQL-下载"><span class="nav-number">1.3.2.</span> <span class="nav-text">2.2 MySQL 下载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-CDH-相关下载"><span class="nav-number">1.3.3.</span> <span class="nav-text">2.3 CDH 相关下载</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-基本配置"><span class="nav-number">1.4.</span> <span class="nav-text">3. 基本配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-0-网路配置"><span class="nav-number">1.4.1.</span> <span class="nav-text">3.0 网路配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-修改主机名并配置hosts（所有节点）"><span class="nav-number">1.4.2.</span> <span class="nav-text">3.1 修改主机名并配置hosts（所有节点）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-小工具安装（所有节点）"><span class="nav-number">1.4.3.</span> <span class="nav-text">3.2 小工具安装（所有节点）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-NTP服务器配置（所有节点，用于几个节点的时间同步）"><span class="nav-number">1.4.4.</span> <span class="nav-text">3.3 NTP服务器配置（所有节点，用于几个节点的时间同步）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-关闭防火墙（所有节点）"><span class="nav-number">1.4.5.</span> <span class="nav-text">3.4 关闭防火墙（所有节点）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-SSH免密码（所有节点）"><span class="nav-number">1.4.6.</span> <span class="nav-text">3.5 SSH免密码（所有节点）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-JDK安装（所有节点）"><span class="nav-number">1.4.7.</span> <span class="nav-text">3.6 JDK安装（所有节点）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-安装MySQL数据库（主节点安装即可）"><span class="nav-number">1.4.8.</span> <span class="nav-text">3.7 安装MySQL数据库（主节点安装即可）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-安装Cloudera-Manager-Server-（主节点操作）"><span class="nav-number">1.4.9.</span> <span class="nav-text">3.7 安装Cloudera Manager Server （主节点操作）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-创建快照"><span class="nav-number">1.5.</span> <span class="nav-text">4. 创建快照</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-启动"><span class="nav-number">1.6.</span> <span class="nav-text">4. 启动</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-启动cloudera-scm-server"><span class="nav-number">1.6.1.</span> <span class="nav-text">4.1 启动cloudera-scm-server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-启动cloudera-scm-agent"><span class="nav-number">1.6.2.</span> <span class="nav-text">4.2 启动cloudera-scm-agent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-进入web界面开始安装"><span class="nav-number">1.6.3.</span> <span class="nav-text">4.3 进入web界面开始安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-接下来重启server"><span class="nav-number">1.6.3.1.</span> <span class="nav-text">4.3.1 接下来重启server</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-2-重启之后，仍然正常登录到这一步"><span class="nav-number">1.6.3.2.</span> <span class="nav-text">4.3.2 重启之后，仍然正常登录到这一步</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-设置开机自启"><span class="nav-number">1.7.</span> <span class="nav-text">4.4 设置开机自启</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#错误总结"><span class="nav-number">1.8.</span> <span class="nav-text">错误总结</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">©2019 by ZZckm</span>

  
</div>








  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>






        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      访客量
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人
    </span>
  

  
    <span class="site-pv">
      总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  


  <!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>

<!-- 鼠标点击爆炸烟花效果 -->

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":120,"height":270},"mobile":{"show":true},"log":false});</script></body>
</html>
